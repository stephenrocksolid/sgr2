{% if links %}
    <table class="related-table">
        <thead>
            <tr>
                <th>Part</th>
                <th>Part Number</th>
                <th>Vendor SKU</th>
                <th>Cost</th>
                <th>Stock</th>
                <th>Lead Time</th>
                <th>Primary Vendor</th>
                <th>Notes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for link in links %}
                <tr class="part-row" data-part-id="{{ link.part.id }}">
                    <td>
                        <strong>{{ link.part.name }}</strong>
                    </td>
                    <td>{{ link.part.part_number }}</td>
                    <td>{{ link.vendor_sku|default:"—" }}</td>
                    <td>{% if link.cost is not None %}${{ link.cost }}{% else %}—{% endif %}</td>
                    <td>{{ link.stock_qty|default:"—" }}</td>
                    <td>{{ link.lead_time_days|default:"—" }} days</td>
                    <td>
                        {% if link.part.primary_vendor_id == link.vendor_id %}
                            <span class="primary-badge">Primary</span>
                        {% else %}
                            No
                        {% endif %}
                    </td>
                    <td>{{ link.notes|default:"—" }}</td>
                    <td class="text-right">
                        <form hx-post="{% url 'inventory:vendor_part_remove' vendor.id link.id %}"
                              hx-target="#vendor-parts-section"
                              hx-swap="innerHTML"
                              hx-confirm="Are you sure you want to remove this part from the vendor?">
                            {% csrf_token %}
                            <button class="btn btn-danger btn-sm" type="submit">Remove</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <div class="empty-message">
        <p class="text-muted">This vendor is not associated with any parts yet.</p>
    </div>
{% endif %}

<div class="mt-3" id="add-part-region">
    {% if show_form %}
        {# Render the form #}
        <h4>Add Part to Vendor</h4>
        {% include "inventory/vendors/_part_add_form.html" with vendor=vendor parts=parts linked_ids=linked_ids q=q %}
    {% else %}
        {# Collapsed state: just a button that reveals the form #}
        <button class="btn btn-secondary"
                hx-get="{% url 'inventory:vendor_parts_partial' vendor.id %}?show_form=1"
                hx-target="#vendor-parts-section"
                hx-swap="innerHTML">
            Add Part
        </button>
    {% endif %}
</div>
