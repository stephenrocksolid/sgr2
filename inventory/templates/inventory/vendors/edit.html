{% extends "base.html" %}
{% load static %}

{% block title %}{% if is_new %}New Vendor{% else %}{{ vendor.name|default:"Vendor" }}{% endif %} - Spring Garden Repair{% endblock %}

{% block content %}
<div class="vendor-page">
    <!-- Sticky Header -->
    <div class="vendor-header">
        <div class="vendor-header-left">
            <div class="vendor-name-display">
                <span class="vendor-label">Vendor</span>
                <h1 class="vendor-name-title">{% if is_new %}New Vendor{% else %}{{ vendor.name|default:"(No Name)" }}{% endif %}</h1>
            </div>
            {% if not is_new and parts_count > 0 %}
            <span class="vendor-parts-badge">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
                {{ parts_count }} Part{{ parts_count|pluralize }}
            </span>
            {% endif %}
        </div>
        <div class="vendor-header-actions">
            <button type="button" class="btn btn-primary" onclick="document.getElementById('vendor-form').requestSubmit()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                {% if is_new %}Create Vendor{% else %}Save Changes{% endif %}
            </button>
            <a href="{% url 'inventory:vendor_index' %}" class="btn btn-outline">Cancel</a>
            {% if not is_new %}
            <button type="button" class="btn btn-danger-outline" 
                    onclick="confirmDelete()"
                    {% if parts_count > 0 %}disabled title="Cannot delete vendor with linked parts"{% endif %}>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete
            </button>
            {% endif %}
        </div>
    </div>

    <form method="post" id="vendor-form">
        {% csrf_token %}
        
        <div class="vendor-layout">
            <!-- Main Content Column -->
            <div class="vendor-main">
                <!-- Basic Information Card -->
                <div class="vendor-card">
                    <div class="vendor-card-header">
                        <div class="vendor-card-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            Basic Information
                        </div>
                    </div>
                    <div class="vendor-card-body">
                        <div class="vendor-form-grid">
                            <div class="vendor-form-group vendor-form-full">
                                <label class="vendor-label">Vendor Name <span class="vendor-required">*</span></label>
                                <input type="text" name="name" value="{{ form.name.value|default_if_none:'' }}" 
                                       class="vendor-input {% if form.name.errors %}is-invalid{% endif %}" 
                                       placeholder="Enter vendor name" required>
                                {% if form.name.errors %}<span class="field-error">{{ form.name.errors.0 }}</span>{% endif %}
                            </div>
                            <div class="vendor-form-group">
                                <label class="vendor-label">Website</label>
                                <div class="vendor-input-with-icon">
                                    <svg class="vendor-input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="2" y1="12" x2="22" y2="12"></line>
                                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                    </svg>
                                    <input type="url" name="website" value="{{ form.website.value|default_if_none:'' }}" 
                                           class="vendor-input vendor-input-icon-pad {% if form.website.errors %}is-invalid{% endif %}" 
                                           placeholder="https://example.com">
                                </div>
                                {% if form.website.errors %}<span class="field-error">{{ form.website.errors.0 }}</span>{% endif %}
                            </div>
                            <div class="vendor-form-group">
                                <label class="vendor-label">Address</label>
                                <textarea name="address" class="vendor-textarea {% if form.address.errors %}is-invalid{% endif %}" 
                                          rows="2" placeholder="Street address, city, state, zip...">{{ form.address.value|default_if_none:'' }}</textarea>
                                {% if form.address.errors %}<span class="field-error">{{ form.address.errors.0 }}</span>{% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes Card -->
                <div class="vendor-card">
                    <div class="vendor-card-header">
                        <div class="vendor-card-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="17" y1="10" x2="3" y2="10"></line>
                                <line x1="21" y1="6" x2="3" y2="6"></line>
                                <line x1="21" y1="14" x2="3" y2="14"></line>
                                <line x1="17" y1="18" x2="3" y2="18"></line>
                            </svg>
                            Additional Notes
                        </div>
                    </div>
                    <div class="vendor-card-body">
                        <div class="vendor-form-group">
                            <textarea name="notes" class="vendor-textarea {% if form.notes.errors %}is-invalid{% endif %}" 
                                      rows="4" placeholder="Add any additional notes about this vendor...">{{ form.notes.value|default_if_none:'' }}</textarea>
                            {% if form.notes.errors %}<span class="field-error">{{ form.notes.errors.0 }}</span>{% endif %}
                        </div>
                    </div>
                </div>

                <!-- Contacts Card -->
                {% if not is_new %}
                {% include "inventory/vendors/_contacts_section.html" %}

                <!-- Parts Supplied Card -->
                <div class="vendor-card">
                    <div class="vendor-card-header">
                        <div class="vendor-card-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                            </svg>
                            Parts Supplied
                            <span class="vendor-badge-count">{{ parts_count }}</span>
                        </div>
                        <button type="button" class="btn btn-sm btn-primary"
                                hx-get="{% url 'inventory:vendor_part_add_modal' vendor.pk %}"
                                hx-target="body"
                                hx-swap="beforeend">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Part
                        </button>
                    </div>
                    <div class="vendor-card-body p-0">
                        <div id="vendor-parts-section"
                             hx-get="{% url 'inventory:vendor_parts_partial' vendor.pk %}"
                             hx-trigger="load"
                             hx-target="this"
                             hx-swap="innerHTML">
                            <div class="vendor-loading-state">
                                <div class="vendor-spinner"></div>
                                <p>Loading parts...</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar Column -->
            <div class="vendor-sidebar">
                {% if not is_new %}
                <!-- Quick Info Card -->
                <div class="vendor-card">
                    <div class="vendor-card-header">
                        <div class="vendor-card-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            Quick Info
                        </div>
                    </div>
                    <div class="vendor-card-body">
                        <div class="vendor-quick-info">
                            <div class="vendor-info-row">
                                <span class="vendor-info-label">Parts Supplied</span>
                                <span class="vendor-info-value">{{ parts_count }}</span>
                            </div>
                            <div class="vendor-info-row">
                                <span class="vendor-info-label">Contacts</span>
                                <span class="vendor-info-value">{{ vendor.contacts.count }}</span>
                            </div>
                            <div class="vendor-info-row">
                                <span class="vendor-info-label">Created</span>
                                <span class="vendor-info-value">{{ vendor.created_at|date:"M d, Y" }}</span>
                            </div>
                            {% if vendor.updated_at %}
                            <div class="vendor-info-row">
                                <span class="vendor-info-label">Last Updated</span>
                                <span class="vendor-info-value">{{ vendor.updated_at|date:"M d, Y" }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Primary Contact Card -->
                {% if vendor.contact_name or vendor.email or vendor.phone %}
                <div class="vendor-card">
                    <div class="vendor-card-header">
                        <div class="vendor-card-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Primary Contact
                        </div>
                    </div>
                    <div class="vendor-card-body">
                        <div class="vendor-primary-contact-info">
                            {% if vendor.contact_name %}
                            <div class="vendor-primary-name">{{ vendor.contact_name }}</div>
                            {% endif %}
                            {% if vendor.email %}
                            <div class="vendor-primary-detail">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                    <polyline points="22,6 12,13 2,6"></polyline>
                                </svg>
                                <a href="mailto:{{ vendor.email }}">{{ vendor.email }}</a>
                            </div>
                            {% endif %}
                            {% if vendor.phone %}
                            <div class="vendor-primary-detail">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                </svg>
                                {{ vendor.phone }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- External Links Card -->
                {% if vendor.website %}
                <div class="vendor-card">
                    <div class="vendor-card-header">
                        <div class="vendor-card-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                            External Links
                        </div>
                    </div>
                    <div class="vendor-card-body">
                        <a href="{{ vendor.website }}" target="_blank" class="vendor-external-link">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="2" y1="12" x2="22" y2="12"></line>
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                            </svg>
                            Visit Website
                            <svg class="external-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </form>

    {% if not is_new %}
    <!-- Delete form (hidden) -->
    <form method="post" action="{% url 'inventory:vendor_delete' vendor.pk %}" id="delete-form" style="display: none;">
        {% csrf_token %}
    </form>
    {% endif %}
</div>

<style>
/* Vendor Page Layout */
.vendor-page {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
}

/* Sticky Header */
.vendor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 1rem 1.5rem;
    margin: -2rem -1rem 1.5rem -1rem;
    border-bottom: 1px solid var(--gray-200);
    position: sticky;
    top: 0;
    z-index: 50;
    box-shadow: var(--shadow-sm);
}

.vendor-header-left {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.vendor-name-display {
    display: flex;
    flex-direction: column;
}

.vendor-name-display .vendor-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--gray-500);
    font-weight: 600;
}

.vendor-name-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin: 0;
    line-height: 1.2;
}

.vendor-parts-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.375rem 0.75rem;
    background: var(--gray-100);
    color: var(--gray-700);
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
}

.vendor-header-actions {
    display: flex;
    gap: 0.75rem;
}

.vendor-header-actions .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

/* Two Column Layout */
.vendor-layout {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 1.5rem;
    align-items: start;
}

.vendor-main {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.vendor-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    position: sticky;
    top: 90px;
}

/* Card Styles */
.vendor-card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: 0.5rem;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
}

.vendor-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.875rem 1.25rem;
    background: var(--gray-50);
    border-bottom: 1px solid var(--gray-200);
}

.vendor-card-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--gray-700);
}

.vendor-card-title svg {
    color: var(--gray-500);
}

.vendor-card-body {
    padding: 1.25rem;
}

.vendor-card-body.p-0 {
    padding: 0;
}

/* Form Elements */
.vendor-form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.vendor-form-group {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    margin-bottom: 0;
}

.vendor-form-full {
    grid-column: 1 / -1;
}

.vendor-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--gray-600);
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.vendor-required {
    color: var(--error);
}

.vendor-input,
.vendor-select,
.vendor-textarea {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--gray-300);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    color: var(--gray-900);
    background: white;
    transition: all 0.15s ease;
    width: 100%;
}

.vendor-input:focus,
.vendor-select:focus,
.vendor-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1);
}

.vendor-input::placeholder,
.vendor-textarea::placeholder {
    color: var(--gray-400);
}

.vendor-input.is-invalid,
.vendor-textarea.is-invalid {
    border-color: var(--error);
}

.vendor-textarea {
    resize: vertical;
    min-height: 80px;
    line-height: 1.5;
}

/* Input with Icon */
.vendor-input-with-icon {
    position: relative;
}

.vendor-input-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    pointer-events: none;
}

.vendor-input-icon-pad {
    padding-left: 2.5rem;
}

.field-error {
    font-size: 0.75rem;
    color: var(--error);
    margin-top: 0.25rem;
}

/* Badge Count */
.vendor-badge-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    height: 20px;
    padding: 0 0.375rem;
    background: var(--gray-200);
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--gray-600);
}

/* Quick Info */
.vendor-quick-info {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.vendor-info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--gray-100);
}

.vendor-info-row:last-child {
    border-bottom: none;
}

.vendor-info-label {
    font-size: 0.8125rem;
    color: var(--gray-600);
}

.vendor-info-value {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--gray-900);
}

/* Primary Contact Info */
.vendor-primary-contact-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.vendor-primary-name {
    font-weight: 600;
    font-size: 0.9375rem;
    color: var(--gray-900);
}

.vendor-primary-detail {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8125rem;
    color: var(--gray-600);
}

.vendor-primary-detail a {
    color: #0369a1;
    text-decoration: none;
}

.vendor-primary-detail a:hover {
    text-decoration: underline;
}

/* External Link */
.vendor-external-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: #e0f2fe;
    border-radius: 0.375rem;
    color: #0369a1;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.15s ease;
}

.vendor-external-link:hover {
    background: #bae6fd;
    color: #075985;
}

.vendor-external-link .external-icon {
    margin-left: auto;
}

/* Contacts Grid */
.vendor-contacts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
    padding: 1rem;
}

.vendor-contact-card {
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 0.5rem;
    padding: 1rem;
}

.vendor-contact-card.is-primary {
    background: #dcfce7;
    border-color: #86efac;
}

.vendor-contact-header {
    margin-bottom: 0.75rem;
}

.vendor-contact-name {
    font-weight: 600;
    color: var(--gray-900);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.vendor-primary-badge {
    padding: 0.125rem 0.5rem;
    background: #16a34a;
    color: white;
    border-radius: 9999px;
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
}

.vendor-contact-title {
    font-size: 0.8125rem;
    color: var(--gray-500);
    font-style: italic;
}

.vendor-contact-details {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    margin-bottom: 0.75rem;
}

.vendor-contact-detail {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.8125rem;
    color: var(--gray-600);
}

.vendor-contact-detail a {
    color: #0369a1;
    text-decoration: none;
}

.vendor-contact-detail a:hover {
    text-decoration: underline;
}

.vendor-contact-detail svg {
    color: var(--gray-400);
}

.vendor-contact-actions {
    display: flex;
    gap: 0.5rem;
}

/* Empty States */
.vendor-empty-contacts {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2.5rem;
    text-align: center;
}

.vendor-empty-contacts svg {
    color: var(--gray-300);
    margin-bottom: 0.75rem;
}

.vendor-empty-contacts p {
    margin: 0 0 0.75rem;
    font-size: 0.875rem;
    color: var(--gray-500);
}

/* Loading State */
.vendor-loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    text-align: center;
}

.vendor-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--gray-200);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: vendor-spin 1s linear infinite;
}

@keyframes vendor-spin {
    to { transform: rotate(360deg); }
}

.vendor-loading-state p {
    margin: 0.75rem 0 0;
    font-size: 0.875rem;
    color: var(--gray-500);
}

/* Button Variants */
.btn-outline {
    background: white;
    color: var(--gray-700);
    border: 1px solid var(--gray-300);
}

.btn-outline:hover {
    background: var(--gray-50);
    border-color: var(--gray-400);
    text-decoration: none;
}

.btn-danger-outline {
    background: white;
    color: var(--error);
    border: 1px solid var(--gray-300);
}

.btn-danger-outline:hover:not(:disabled) {
    background: #fef2f2;
    border-color: var(--error);
}

.btn-danger-outline:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Responsive */
@media (max-width: 1024px) {
    .vendor-layout {
        grid-template-columns: 1fr;
    }
    
    .vendor-sidebar {
        position: static;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }
}

@media (max-width: 768px) {
    .vendor-sidebar {
        grid-template-columns: 1fr;
    }
    
    .vendor-form-grid {
        grid-template-columns: 1fr;
    }
    
    .vendor-contacts-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 640px) {
    .vendor-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .vendor-header-left {
        flex-wrap: wrap;
    }
    
    .vendor-header-actions {
        flex-wrap: wrap;
    }
}
</style>

<script>
{% if not is_new %}
function confirmDelete() {
    {% if parts_count > 0 %}
    alert('Cannot delete this vendor because it has linked parts.');
    {% else %}
    if(confirm('Are you sure you want to delete this vendor? This action cannot be undone.')) {
        document.getElementById('delete-form').submit();
    }
    {% endif %}
}
{% endif %}

// Event delegation for clickable rows - works with HTMX-loaded content
document.body.addEventListener('click', function(e) {
    // Find if click was on a clickable row
    const row = e.target.closest('.vendor-clickable-row');
    if (!row) return;
    
    // Don't navigate if clicking on actions cell or button
    // Note: We check for .vendor-actions-cell or direct button click, NOT parent form
    // because the whole page is wrapped in a form
    if (e.target.closest('.vendor-actions-cell') || e.target.closest('.vendor-actions-group') || e.target.closest('button')) {
        return;
    }
    
    // Navigate to the href
    const href = row.getAttribute('data-href');
    if (href) {
        window.location.href = href;
    }
});

// Handle escape key for modals
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modals = document.querySelectorAll('.po-modal-overlay');
        modals.forEach(modal => modal.remove());
    }
});
</script>
{% endblock %}
